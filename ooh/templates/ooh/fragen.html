{% extends 'ooh/base.html' %}
{% load static %}


{% block content %}

<div class="qu-container">
    <div class="qu-box">
        <h3>{{ question.name }}</h3>
        <div id="choices" class="radio-buttons">
        <form id="einsNiceForm" action="{% url 'ooh:questions' nextpage %}" method="GET">
        {% for key, value in request.GET.items %}
            <input type="hidden" name="{{ key }}" value="{{ value }}">
        {% endfor %}
        
        {% for choice in question.question.all %}
            <label class="custom-radio">
                <input type="radio" name="q{{question.id}}" value="{{ choice.text }}" required/>
                <span class="radio-btn">
                    <i class="fas fa-check"></i>
                    <div class="hobbies-icon">
                        <i class="{{ choice.class_names }}"></i>
                        <h4>{{ choice.text }}</h4>
                    </div>
                </span>
            </label>
        {% endfor %}
        </form>    
        </div>
        
        <div class="progress-container">
            <div id="progress-main">
                <!-- <p id="progress-content"  class="text-center">Step Number 1</p> -->
                <div class="">
                    <button class="progress-button" id="previousBtn" {% if question.id == 1 %} disabled {% endif %}><span>Previous</span></button>
                </div>
                <div>
                    <button class="progress-button" id="nextBtn"><span>Next</span></button>
                </div>
                <div>
                    <button class="finish-button" id="finishBtn">Finish</button>
                </div>
            </div>
            <div id="stepProgressBar">
                <div class="step">
                    <!-- <p class="step-text">About</p> -->
                    <div class="bullet"></div>
                </div>
                <div class="step">
                    <!-- <p class="step-text">Contact</p> -->
                    <div class="bullet"></div>
                </div>
                <div class="step">
                    <!-- <p class="step-text">Step 3</p> -->
                    <div class="bullet"></div>
                </div>
                <div class="step">
                    <!-- <p class="step-text">Step 4</p> -->
                    <div class="bullet "></div>
                </div>
                <div class="step">
                    <!-- <p class="step-text">Step 4</p> -->
                    <div class="bullet "></div>
                </div>
                #<div class="step">
                    <!-- <p class="step-text">Step 4</p> -->
                    <div class="bullet "></div>
                </div>
            </div>
        </div>
    </div>
    
</div>

<script type="text/javascript">  
    $(document).ready(function(){
        const  previousBtn  =  document.getElementById('previousBtn');
        const  nextBtn  =  document.getElementById('nextBtn');
        const  finishBtn  =  document.getElementById('finishBtn');
        const  content  =  document.getElementById('progress-content');
        const  bullets  =  [...document.querySelectorAll('.bullet')];

        let currentStep = {{question.id}};
        const MAX_STEPS = 6;
        
        for (var i=0; i<currentStep; i++) {
           bullets[i].classList.add('completed');
        }

        if (currentStep  ===  MAX_STEPS) {
            finishBtn.style.cursor = "pointer";
            finishBtn.style.border = "2px solid #ff6a00";
            finishBtn.style.color = "#ff6a00";
            nextBtn.disabled  =  true;
            finishBtn.disabled  =  false;
        }

        nextBtn.addEventListener('click',  ()  =>  {
            url = "{% url 'ooh:questions' nextpage %}"
            document.getElementById("einsNiceForm").submit();
        });


        previousBtn.addEventListener('click',  ()  =>  {
            bullets[currentStep  -  2].classList.remove('completed');
            currentStep  -=  1;
            url = "{% url 'ooh:questions' prevpage %}"+window.location.search;
            window.open(url+"", name="_self" );
            
        });

        finishBtn.addEventListener('click',  ()  =>  {
            if  (currentStep  ===  MAX_STEPS)  {
                finishBtn.classList.add('finish-active');
                // $(this).addClass("finish-active");

                setTimeout(function(){
                    finishBtn.classList.add('finish-success');
                    // $(".finish-button").addClass("finish-success")
                }, 3000);

                setTimeout(function(){
                    finishBtn.classList.remove('finish-active');
                    // $(".finish-button").removeClass("finish-active");
                    finishBtn.classList.remove('finish-success');
                    // $(".finish-button").removeClass("finish-success");
                }, 5000);
                
                // location.reload();   
            }
        });
    });
</script>

{% endblock %}